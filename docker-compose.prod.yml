# SignalTrackers Financial Dashboard
# Docker Compose for PRODUCTION DEPLOYMENT (Portainer)
#
# This file uses the published GitHub Container Registry image.
# For local development and testing, use docker-compose.yml
#
# Usage in Portainer:
#   1. Create stack in Portainer
#   2. Paste this file OR point to repository
#   3. Set environment variables in Portainer stack settings
#   4. Deploy
#
# Manual usage:
#   docker-compose -f docker-compose.prod.yml up -d
#
# To update to latest image:
#   docker-compose -f docker-compose.prod.yml pull
#   docker-compose -f docker-compose.prod.yml up -d

version: '3.8'

services:
  signaltrackers:
    image: ghcr.io/ericmaibach/financial:latest
    container_name: signaltrackers
    ports:
      - "5000:5000"
    environment:
      # Application Security (Required for Multi-User Mode)
      - SECRET_KEY=${SECRET_KEY:-dev-key-change-in-production}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-}

      # AI Provider: 'openai' or 'anthropic' (for scheduled briefings)
      - AI_PROVIDER=${AI_PROVIDER:-anthropic}

      # System API Keys (for scheduled briefings - set in .env file)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - FRED_API_KEY=${FRED_API_KEY:-}
      - TAVILY_API_KEY=${TAVILY_API_KEY:-}

      # Anthropic effort level (low/medium/high/max)
      - ANTHROPIC_EFFORT=${ANTHROPIC_EFFORT:-medium}

      # Email Configuration (for alerts and briefings)
      - MAIL_SERVER=${MAIL_SERVER:-smtp-relay.brevo.com}
      - MAIL_PORT=${MAIL_PORT:-587}
      - MAIL_USE_TLS=${MAIL_USE_TLS:-True}
      - MAIL_USE_SSL=${MAIL_USE_SSL:-False}
      - MAIL_USERNAME=${MAIL_USERNAME:-}
      - MAIL_PASSWORD=${MAIL_PASSWORD:-}
      - MAIL_DEFAULT_SENDER=${MAIL_DEFAULT_SENDER:-}
      - BASE_URL=${BASE_URL:-http://localhost:5000}
    volumes:
      # Persist market data between container restarts
      - ./signaltrackers/data:/app/data
      # Optionally persist logs
      - ./signaltrackers/logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# Optional: Add a volume for data if you prefer named volumes
# volumes:
#   signaltrackers-data:
