# SignalTrackers Financial Dashboard
# Docker Compose for local development and testing
#
# Usage:
#   1. Copy .env.example to .env and fill in your API keys
#   2. Run: docker-compose up --build
#   3. Access: http://localhost:5000
#
# To run in background: docker-compose up -d
# To view logs: docker-compose logs -f
# To stop: docker-compose down

version: '3.8'

services:
  signaltrackers:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: signaltrackers
    ports:
      - "5000:5000"
    environment:
      # Application Security (Required for Multi-User Mode)
      - SECRET_KEY=${SECRET_KEY:-dev-key-change-in-production}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-}

      # AI Provider: 'openai' or 'anthropic' (for scheduled briefings)
      - AI_PROVIDER=${AI_PROVIDER:-anthropic}

      # System API Keys (for scheduled briefings - set in .env file)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - FRED_API_KEY=${FRED_API_KEY:-}
      - TAVILY_API_KEY=${TAVILY_API_KEY:-}

      # Anthropic effort level (low/medium/high/max)
      - ANTHROPIC_EFFORT=${ANTHROPIC_EFFORT:-medium}

      # Email Configuration (for alerts and briefings)
      - MAIL_SERVER=${MAIL_SERVER:-smtp-relay.brevo.com}
      - MAIL_PORT=${MAIL_PORT:-587}
      - MAIL_USE_TLS=${MAIL_USE_TLS:-True}
      - MAIL_USE_SSL=${MAIL_USE_SSL:-False}
      - MAIL_USERNAME=${MAIL_USERNAME:-}
      - MAIL_PASSWORD=${MAIL_PASSWORD:-}
      - MAIL_DEFAULT_SENDER=${MAIL_DEFAULT_SENDER:-}
    volumes:
      # Persist market data between container restarts
      - ./signaltrackers/data:/app/data
      # Optionally persist logs
      - ./signaltrackers/logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# Optional: Add a volume for data if you prefer named volumes
# volumes:
#   signaltrackers-data:
