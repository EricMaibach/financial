{% extends "email/base_email.html" %}

{% block title %}Market Alert{% if alerts|length > 1 %}s{% endif %} - SignalTrackers{% endblock %}

{% block content %}
<!-- Remove the default padding from base template for custom layout -->
</td></tr>

<!-- Alert Header -->
<tr>
    <td style="padding: 30px 20px; background-color: {{ header_bg_color }}; text-align: center; border-left: 4px solid {{ border_color }};">
        <h1 style="color: {{ header_text_color }}; margin: 0; font-size: 24px; font-weight: 600;">
            ðŸš¨ Market Alert{% if alerts|length > 1 %}s{% endif %} Triggered
        </h1>
        <p style="color: {{ header_text_color }}; opacity: 0.9; margin: 10px 0 0 0; font-size: 14px;">
            {{ triggered_time }}
        </p>
    </td>
</tr>

<!-- Alert Summary (if multiple) -->
{% if alerts|length > 1 %}
<tr>
    <td style="padding: 20px; background-color: #f8f9fa;">
        <p style="margin: 0; font-size: 15px; color: #495057;">
            <strong>{{ alerts|length }} alerts</strong> were triggered based on your notification preferences.
        </p>
    </td>
</tr>
{% endif %}

<!-- Alert Details -->
{% for alert in alerts %}
<tr>
    <td style="padding: 30px 20px; {% if not loop.last %}border-bottom: 2px solid #dee2e6;{% endif %}">
        <!-- Alert Title with Severity Badge -->
        <div style="margin-bottom: 15px;">
            <span style="display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; background-color: {{ alert.severity_badge_color }}; color: {{ alert.severity_text_color }}; margin-right: 10px;">
                {{ alert.severity|upper }}
            </span>
            <h2 style="display: inline; color: #212529; font-size: 20px; margin: 0;">
                {{ alert.title }}
            </h2>
        </div>

        <!-- Alert Message -->
        <p style="color: #495057; font-size: 15px; line-height: 1.6; margin: 0 0 15px 0;">
            {{ alert.message }}
        </p>

        <!-- Metric Details (if available) -->
        {% if alert.metric_name %}
        <table style="background-color: #f8f9fa; border-radius: 6px; width: 100%; margin-top: 15px;" cellpadding="12" cellspacing="0">
            <tr>
                <td style="border-right: 1px solid #dee2e6; width: 50%;">
                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">METRIC</div>
                    <div style="font-size: 16px; font-weight: 600; color: #212529;">{{ alert.metric_name }}</div>
                </td>
                <td style="border-right: 1px solid #dee2e6; width: 25%;">
                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">CURRENT</div>
                    <div style="font-size: 16px; font-weight: 600; color: #212529; font-family: 'Courier New', monospace;">
                        {{ alert.metric_value_formatted }}
                    </div>
                </td>
                <td style="width: 25%;">
                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">THRESHOLD</div>
                    <div style="font-size: 16px; font-weight: 600; color: #6c757d; font-family: 'Courier New', monospace;">
                        {{ alert.threshold_value_formatted }}
                    </div>
                </td>
            </tr>
        </table>
        {% endif %}
    </td>
</tr>
{% endfor %}

<!-- Action Button -->
<tr>
    <td style="padding: 30px 20px; text-align: center; background-color: #f8f9fa;">
        <a href="{{ dashboard_url }}" style="display: inline-block; padding: 15px 40px; background-color: #dc3545; color: white; text-decoration: none; border-radius: 6px; font-size: 16px; font-weight: 600; margin-bottom: 15px;">
            View Dashboard â†’
        </a>
        <br>
        <a href="{{ alert_history_url }}" style="color: #6c757d; font-size: 14px; text-decoration: underline;">
            View Alert History
        </a>
    </td>
</tr>

<!-- Alert Management -->
<tr>
    <td style="padding: 20px; background-color: #fff; border-top: 1px solid #dee2e6;">
        <p style="margin: 0; font-size: 13px; color: #6c757d; text-align: center;">
            Manage your alert preferences in
            <a href="{{ settings_url }}" style="color: #667eea; text-decoration: none;">Settings</a>
        </p>
    </td>
</tr>

<!-- Re-open content td/tr for base template footer -->
<tr><td style="padding: 0;">
{% endblock %}
