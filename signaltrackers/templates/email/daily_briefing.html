{% extends "email/base_email.html" %}

{% block title %}Your Daily Market Briefing - SignalTrackers{% endblock %}

{% block content %}
<!-- Remove the default padding from base template for custom layout -->
</td></tr>

<!-- Hero Header -->
<tr>
    <td style="padding: 30px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); text-align: center;">
        <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 600;">
            ðŸ“Š Your Daily Market Briefing
        </h1>
        <p style="color: rgba(255,255,255,0.9); margin: 10px 0 0 0; font-size: 14px;">
            {{ briefing_date }}
        </p>
    </td>
</tr>

<!-- AI Market Briefing Section (conditional - only if AI configured) -->
{% if market_briefing_html %}
<!-- One-liner Synthesis (Preheader) -->
<tr>
    <td style="padding: 20px; background-color: #f8f9fa; border-left: 4px solid #667eea;">
        <p style="margin: 0; font-size: 16px; font-style: italic; color: #495057;">
            <strong>Today's Snapshot:</strong> {{ market_synthesis }}
        </p>
    </td>
</tr>

<!-- Section 1: Today's Market Briefing -->
<tr>
    <td style="padding: 30px 20px;">
        <h2 style="color: #212529; font-size: 22px; margin: 0 0 15px 0; border-bottom: 2px solid #dee2e6; padding-bottom: 10px;">
            ðŸ“ˆ Today's Market Briefing
        </h2>
        <div style="color: #495057; font-size: 15px; line-height: 1.6;">
            {{ market_briefing_html | safe }}
        </div>
    </td>
</tr>
{% endif %}

<!-- Section 2: Market Conditions at a Glance -->
<tr>
    <td style="padding: 20px; background-color: #f8f9fa;">
        <h2 style="color: #212529; font-size: 22px; margin: 0 0 15px 0;">
            ðŸŽ¯ Market Conditions at a Glance
        </h2>
        <table width="100%" cellpadding="10" cellspacing="0">
            <tr>
                {% for condition in market_conditions %}
                <td width="33%" style="text-align: center; padding: 10px;">
                    <div style="font-size: 24px; margin-bottom: 5px;">{{ condition.icon }}</div>
                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">{{ condition.name }}</div>
                    <span style="display: inline-block; padding: 5px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; background-color: {{ condition.badge_color }}; color: {{ condition.text_color }};">
                        {{ condition.status }}
                    </span>
                </td>
                {% if loop.index is divisibleby 3 %}
                </tr><tr>
                {% endif %}
                {% endfor %}
            </tr>
        </table>
    </td>
</tr>

<!-- Section 3: What's Moving Today -->
<tr>
    <td style="padding: 30px 20px;">
        <h2 style="color: #212529; font-size: 22px; margin: 0 0 15px 0;">
            âš¡ What's Moving Today
        </h2>
        <table width="100%" cellpadding="8" cellspacing="0" style="border-collapse: collapse;">
            <thead>
                <tr style="background-color: #e9ecef;">
                    <th style="text-align: left; padding: 10px; font-size: 12px; color: #6c757d;">Metric</th>
                    <th style="text-align: right; padding: 10px; font-size: 12px; color: #6c757d;">Value</th>
                    <th style="text-align: right; padding: 10px; font-size: 12px; color: #6c757d;">Percentile</th>
                    <th style="text-align: right; padding: 10px; font-size: 12px; color: #6c757d;">Change</th>
                </tr>
            </thead>
            <tbody>
                {% for mover in top_movers %}
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 10px; font-size: 14px; color: #212529;">{{ mover.name }}</td>
                    <td style="padding: 10px; text-align: right; font-family: 'Courier New', monospace; font-size: 14px;">{{ mover.value }}</td>
                    <td style="padding: 10px; text-align: right; font-size: 14px;">{{ mover.percentile }}%</td>
                    <td style="padding: 10px; text-align: right; font-size: 14px; color: {{ mover.change_color }};">
                        {{ mover.change_arrow }} {{ mover.change }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </td>
</tr>

<!-- Section 4: Portfolio Context (conditional) -->
{% if include_portfolio and portfolio_analysis %}
<tr>
    <td style="padding: 20px; background-color: #fff3cd; border-left: 4px solid #ffc107;">
        <h2 style="color: #212529; font-size: 22px; margin: 0 0 10px 0;">
            ðŸ’¼ Your Portfolio Context
        </h2>
        <p style="margin: 0; color: #495057; font-size: 14px; line-height: 1.6;">
            {{ portfolio_analysis }}
        </p>
    </td>
</tr>
{% endif %}

<!-- Section 5: Triggered Alerts (conditional) -->
{% if triggered_alerts and triggered_alerts|length > 0 %}
<tr>
    <td style="padding: 30px 20px; background-color: #f8d7da; border-left: 4px solid #dc3545;">
        <h2 style="color: #721c24; font-size: 22px; margin: 0 0 15px 0;">
            ðŸš¨ Alerts Triggered (Last 24h)
        </h2>
        {% for alert in triggered_alerts %}
        <div style="margin-bottom: 10px; padding: 10px; background-color: white; border-radius: 4px;">
            <strong style="color: #212529;">{{ alert.title }}</strong>
            {% if alert.message %}
            <p style="margin: 5px 0 0 0; font-size: 13px; color: #6c757d;">{{ alert.message }}</p>
            {% endif %}
        </div>
        {% endfor %}
    </td>
</tr>
{% endif %}

<!-- CTA Button -->
<tr>
    <td style="padding: 30px 20px; text-align: center;">
        <a href="{{ dashboard_url }}" style="display: inline-block; padding: 15px 40px; background-color: #667eea; color: white; text-decoration: none; border-radius: 6px; font-size: 16px; font-weight: 600;">
            View Full Dashboard â†’
        </a>
    </td>
</tr>

<!-- Restore base template structure -->
<tr><td style="padding: 30px 30px 40px 30px; color: #333333; font-size: 16px; line-height: 1.6;">
{% endblock %}
